\vspace{2mm}
\ffigbox[\FBwidth]{%
\caption{\centering Représentation du problème \(PL\) initial}\label{fig:td1_ex16_f1}
}{
    \fbox{
        \begin{tikzpicture}
            \begin{axis}[
                % axis lines=middle,
                xlabel={\(x_1\)},
                ylabel={\(x_2\)},
                xmin=0, xmax=4,
                ymin=0, ymax=4,
                grid=both,
                axis equal image, % <-- orthonormal grid
                width=10cm,
                height=7cm,
                legend pos=outer north east, % <-- legend outside
                legend cell align=left,
                legend image post style={fill opacity=0.45},
                legend style={fill=pagebg, draw=pagetext}
            ]

            % ----- Constraint lines -----
            % just have to express x2 in terms of x1 for each constraint
            % x + y = 2 -> y = 2 - x

            % 2x1 + 1x2 = 6 -> x2 = 6 - 2x1
            \addplot[domain=0:4, very thick, color=blue] {6 - 2*x};
            \addlegendentry{\(2x_1 + x_2 = 6\)}

            % 2x1 + 3x2 = 9 -> x2 = (9 - 2x1)/3
            \addplot[domain=0:4, very thick, color=orange] {(9 - 2*x)/3};
            \addlegendentry{\(2x_1 + 3x_2 = 9\)}

            % optimal cut
            % x2 = -2x1 + 3
            \addplot[domain=0:4, very thick, dashed, color=magenta] {(3 - x)};
            \addlegendentry{Coupe optimale \(x_1 + x_2 = 3\)}

            % ----- Feasible region -----
            \addplot[
                fill=cyan!30,
                opacity=0.45,
                draw=none,
                area legend
            ] coordinates {
                (0,0)
                (0,3)
                (9/4, 3/2)
                (3,0)
            };
            \addlegendentry{Région réalisable initiale}

            % ----- Feasible region 2 -----
            \addplot[
                fill=red!30,
                opacity=0.45,
                draw=none,
                area legend
            ] coordinates {
                (0,0)
                (0,3)
                (3,0)
            };
            \addlegendentry{Région réalisable après les coupes}

            % ----- Optimal real solution -----
            \addplot[
                only marks,
                mark=*,
                mark size=2.5pt,
                color=red!80!black
            ] coordinates {(9/4, 3/2)};
            \addlegendentry{Solution réelle}

            % ----- Optimal integer solution -----
            \addplot[
                only marks,
                mark=square*,
                mark size=2.5pt,
                color=purple
            ] coordinates {(0,3)};
            \addlegendentry{Solution entière}
            
            % % ----- Level line for the objective function -----
            % % z is a vector, the level line is orthogonal to the vector of coefficients of the objective function
            % % 2x1 + x2 -> z = 2x1 + x2
            % 3x1 + 4x2 -> z = 3x1 + 4x2
            % % we can express x2 in terms of z and x1: x2 = z - 2x1
            % x2 = (z - 3x1)/4
            
            \addplot[dashed, thick, yellow, domain=0:4] {51/16 - (3/4)*x};
            \addlegendentry{Ligne de niveau \(z=\frac{51}{4}\)}
            \end{axis}
        \end{tikzpicture}
    }
}