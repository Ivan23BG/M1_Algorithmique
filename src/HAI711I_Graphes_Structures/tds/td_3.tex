% ----- Consignes exo 1 ----- %
\begin{td-exo}[Glouglouglou]\,\\ % 1 
	Dérouler à la main l'algorithme de ford-Fulkerson sur les deux réseaux de transport suivants afin de déterminer dans chaque cas un flot maximal ainsi qu'une coupe minimale (les valeurs notées sur les arcs sont les capacités correspondantes).
    Pour le second graphe, on commencera par une augmentation de flot le long du chemin \(sabdp\) suivi d'une augmentation de flot le long de \(scedbap\).

    % TODO Insert 2 graphs here
\end{td-exo}

% ----- Solutions exo 1 ----- %
\iftoggle{showsolutions}{
	\begin{td-sol}[]\,\\ %
		A remplir %TODO solve exercise 1
	\end{td-sol}
}{}


% ----- Consignes exo 2 ----- %
\begin{td-exo}[PL]\,\\ % 2 
	Soit \(\mathcal{N} = (D, s, p, c)\) un réseau de transport. Montrer qu'il est possible d'écrire un programme linéaire correspondant à la racherche d'un flot de valeur maximal dans \(\mathcal N\).
    On proposera un modèle utilisant un nombre polynomial (en la taille de \(D\)) de variables et de contraintes.
\end{td-exo}

% ----- Solutions exo 2 ----- %
\iftoggle{showsolutions}{
	\begin{td-sol}[]\,\\ %
		A remplir %TODO solve exercise 2
	\end{td-sol}
}{}


% ----- Consignes exo 3 ----- %
\begin{td-exo}[Décomposition d'un flot]\,\\ % 3 
	Soit \(f\) un flot à valeurs entières sur un réseau de transport \(\mathcal{N} = (D, s, p, c)\).
    On veut montrer qu'il existe dans \(D\) un multi-ensemble (un ensemble où les éléments peuvent apparaitre plusieurs fois) de chemins \(P_1,\ldots,P_k\) tous de \(s\) à \(p\) et un multi-ensemble de cycles \(C_1,\ldots,C_l\) tels que pour tout arc \(xy\) de \(D\) on ait \(f(xy) = \#\{i\in \{1,\ldots,k\}: xy\in P_i\} + \#\{j\in \{1,\ldots,l\}: xy\in C_j\}\).
    \begin{enumerate}
        \item Sur le premier graphe de l'exercice 1, % TODO add reference here
        on considère le flot \(f\) défini par \(f(ab) = 5, f(bc) = 2, f(bp) = 4, f(ca) = 2, f(cd) = 1, f(db) = 1, f(sa) = 3, f(sc) = 1\).
        Donner la décomposition voulue.

        \item Prouver le résultat attendu en raisonnant par récurrence sur \(\sum_{xy\in A(D)} f(xy)\).
    \end{enumerate}
\end{td-exo}

% ----- Solutions exo 3 ----- %
\iftoggle{showsolutions}{
	\begin{td-sol}[]\, %
		\begin{enumerate}
			\item La décomposition est:
			\begin{itemize}
				\item On prend une fois le chemin \(scdp\).
				\item On prend 3 fois le chemin \(sabp\).
				\item On prend 2 fois le cycle \(abc\).
			\end{itemize}

			\item Si la somme vaut 0 alors on ne prend aucun chemin ou cycle.

			Sinon, on a 
			\begin{equation*}
				\sum_{xy\in A(D)} f(xy) = S > 0
			\end{equation*}
			et on suppose que la propriété est vraie pour toute somme de flot \( < S\).

			On note \(D_f\) le graphe orienté formé des arcs partant du flot 
			\begin{equation*}
				D_f = \left(
					V, \{xy \in A(D) : f(xy) > 0\}.
				\right)
			\end{equation*}
			Deux cas se présentent:
			\begin{itemize}
				\item Premier cas: \(|f| > 0 : \exists a \in N^+(s)\) avec \(f(sa) > 0\). 

				Notons \(X = \big\{\)sommets de \(D_f\) tels qu'il existe un chemin de \(D_f\) de \(s\) à \(x\big\}\).

				Par la propriété du cours, si \(p \notin X\), on a
				\begin{equation*}
					f(X, \ol X) = |f| + f(\ol X, X) \ge |f| > 0
				\end{equation*}
				et donc il existe \(uv \in A(D)\) tel que \(u \in X, v \in \ol X\) et \(f(uv) > 0\)
				mais alors \(v\) doit appartenir à \(X\), contradiction.

				Il existe donc un chemin \(P\) de \(s\) à \(p\) dans \(D_f\), c'est-à-dire:
				\begin{equation*}
					\forall xy \in P, f(xy) \geq 1 \quad ( > 0)
				\end{equation*}

				On définit le flot \(f'\) par 
				\begin{equation*}
					\begin{cases}
						f'(uv) = f(uv) & \text{si } uv \notin P\\
						f'(uv) = f(uv) - 1 & \text{si } uv \in P
					\end{cases}
				\end{equation*}
				et on garde la conservation du flot.

				On a 
				\begin{equation*}
					\begin{aligned}
						\sum_{xy\in A(D)} f'(xy)
						&= \sum_{xy\in A(D)} f(xy) - \mathsf{long}(P)\\
						& < \sum_{xy\in A(D)} f(xy)
					\end{aligned}
				\end{equation*}
				Par récurrence, il existe \(P_1, \ldots, P_k\) chemins dirigés de \(s\) à \(p\) et \(C_1, \ldots, C_l\) cycles dirigés tels que 
				\begin{equation*}
					\begin{aligned}
						\forall xy \in A(D), f'(xy) 
						&= \#\{i\in \{1,\ldots,k\}: xy\in P_i\} \\
						&+ \#\{j\in \{1,\ldots,l\}: xy\in C_j\}
					\end{aligned}
				\end{equation*}
				On pose alors \(P_{k+1} = P\) et on a la décomposition suivante:
				\begin{equation*}
					\begin{aligned}
						\forall xy \in A(D), xy \notin P \quad f(xy) = f'(xy) 
						&= \#\{i\in \{1,\ldots,k+1\}: xy\in P_i\} \\
						&+ \#\{j\in \{1,\ldots,l\}: xy\in C_j\}
					\end{aligned}
				\end{equation*}
				et 
				\begin{equation*}
					\begin{aligned}
						\forall xy \in A(D), xy \in P \quad f(xy) = f'(xy) + 1 
						&= \#\{i\in \{1,\ldots,k\}: xy\in P_i\} \\
						&+ \#\{j\in \{1,\ldots,l\}: xy\in C_j\} + 1
					\end{aligned}
				\end{equation*}

				\item Second cas: \(|f| = 0\). Comme on a \(\sum_{xy\in A(D)} f(xy) > 0\), il existe un arc \(uv \in A(D)\) tel que 
				\begin{equation*}
					f(uv) \geq 1
				\end{equation*}
				On note \(X = \big\{z\)sommets de \(D_f\) tels qu'il existe un chemin dirigé de \(z\) à \(u\) dans \(D_f\big\}\). Montrons que \(v\in X\).

				On a \(s \notin X\) car \(|f| = 0\) donc aucun arc de \(D_f\) ne sort de \(s\). Alors 
				% insert schema here 
				et \(f(X, \ol X) = f(\ol X, X)\) donc si \(v \notin X\), on a
				\begin{equation*}
					f(X, \ol X) > 0 \implies f(\ol X, X) > 0
				\end{equation*}
				et il existerait \(a\notin X, b \in X\) tel que \(f(ab) > 0\) donc \(a \in X\), contradiction.

				Donc \(v\in X\) et il existe un cycle dirigé \(C\) dans \(D_f\) contenant l'arc \(uv\).

				Comme précédemment, on définit le flot \(f'\) par
				\begin{equation*}
					\begin{cases}
						f'(xy) = f(xy) & \text{si } xy \notin C\\
						f'(xy) = f(xy) - 1 & \text{si } xy \in C
					\end{cases}
				\end{equation*}
				et on garde la conservation du flot. On applique la récurrence au flot \(f'\) et on conclut de la même manière en ajoutant le cycle \(C\) à la décomposition.
			\end{itemize}
		\end{enumerate}
	\end{td-sol}
}{}


% ----- Consignes exo 4 ----- %
\begin{td-exo}[Théorème de Hall]\,\\ % 4 
	Soit \(G = ((A, B), E)\) un graphe biparti (de bipartition \((A, B)\)).
	On souhaite montrer le théorème de Hall en utilisant ldes résultats de flots.
	Pour cela, on considère le réseau de transport \(\mathcal{N} = (D, s, p, c)\) où \(D\) est obtenu depuis \(G\) en ajoutant une source \(s\) dominant tous les sommets de \(A\), en orientant toutes les arêtes de \(G\) de \(A\) vers \(B\) puis en ajoutant un puits \(p\) dominé par tous les sommets de \(B\).
	Finalement, pour obtenir \(\mathcal N\), on munit chaque arc de \(D\) d'une capacité de \(1\).
	\begin{enumerate}
		\item Soit \(X\) une \((s,p)\)-coupe de capacité minimum et telle que \(|X \cap A|\) soit minimal pour cela.
		Montrer qu'il n'y a pas d'arc dans \(D\) de \(X \cap A\) vers \(B \setminus X\).

		\item Montrer que pour tout entier \(k\), il y a une correspondance entre les flots entiers \(f\) de \(\mathcal{N}\) avec \(|f| = k\) et les couplages de \(G\) de taille \(k\).

		\item Déduire le théorème de Hall du théorème \og{}\defemph{min cut = max flot}\fg{}.
	\end{enumerate}
\end{td-exo}

% ----- Solutions exo 4 ----- %
\iftoggle{showsolutions}{
	\begin{td-sol}[]\, %
		% inserer reseau de transport schema ici
		\begin{enumerate}
			\item\label{td3:ex4:1} Sinon, il existe une arête \(uv\) avec \(u \in X \cap A\) et \(v \in B \setminus X\).
			% insert second small illustration here

			On considère la \((s,p)\)-coupe \((X', \ol X') = (X \setminus \{u\}, \ol X \cup \{u\})\).

			Les arcs qui traversent \(X', \ol X'\) sont ceux de \(X, \ol X\) moins les arcs sortant de \(u\) (dont au moins \(uv\)) plus les arcs entrants en \(u\) depuis \(X'\), c'est-à-dire \(su\).

			Donc 
			\begin{equation*}
				c(X', \ol X') \leq c(X, \ol X) 
			\end{equation*}

			Commme \((X, \ol X)\) est une \((s,p)\)-coupe min, on a l'égalité et donc \((X', \ol X')\) est aussi une \((s,p)\)-coupe min. Mais \(|X' \cap A| = |X \cap A \setminus \{u\}| < |X \cap A|\), ce qui contredit la minimalité de \(|X \cap A|\).

			Donc, il n'y a pas d'arc dans \(D\) de \(X \cap A\) vers \(B \setminus X\).

			\item Supposons que \(\mathcal{N}\) admette un flot entier \(f\) de valeur \(k\).
			Si \(x\) est un voisin de \(s\) avec \(f(sx) > 0\), alors 
			\begin{equation*}
				1 \leq f(sx) \leq c(sx) = 1
			\end{equation*}
			et donc \(f(sx) = 1\). Donc il existe \(x_1, \ldots, x_k\) \(k\) sommets distincts de \(A\) tels que \(f(sx_i) = 1\) pour tout \(i \in \{1, \ldots, k\}\) et pour tout autre voisin \(x\) de \(s\), \(f(sx) = 0\).

			Pour tout sommet \(x_i\), le flot sortant de \(x_i\) doit être égal à \(1\) (car le flot entrant est \(1\) et la conservation du flot s'applique) donc il existe un voisin \(y_i\) de \(x_i\) dans \(B\) tel que \(f(x_i y_i) = 1\).

			De plus, les \(y_i\) sont distincts car sinon on aurait \(f(x_i y_i) = 1\) et \(f(x_j y_i) = 1\) pour \(i \neq j\) et donc le flot entrant en \(y_i\) serait au moins de \(2\). Par conservation du flot, le flot sortant de \(y_i\) serait aussi au moins de \(2\) ce qui est impossible car le seul arc sortant de \(y_i\) est \(y_i p\) qui est de capacité \(1\).

			Alors, les arêtes \(x_1 y_1, x_2 y_2, \ldots, x_k y_k\) forment un couplage de taille \(k\) dans \(G\).

			Et inversement, si \(M\) est un couplage de taille \(k\) dans \(G\), on peut définir un flot \(f\) dans \(\mathcal{N}\) par
			\begin{equation*}
				f(xy) = 
				\begin{cases}
					1 & \text{si } x = s \text{ et } y \in A \text{ avec } (y,\cdot) \in M\\
					1 & \text{si } x \in A, y \in B \text{ avec } xy \in M\\
					1 & \text{si } x \in B \text{ et } y = p \text{ avec } (\cdot,x) \in M\\
					0 & \text{sinon}
				\end{cases}
			\end{equation*}
			et on vérifie facilement que \(f\) est un flot de valeur \(k\).

			\item On va montrer la contraposée du théorème de Hall:
			
			Si la taille d'un couplage maximum du \(G\) est strictement inférieure à \(|A|\), alors il existe \(S \subseteq A\) tel que \(|N(S)| < |S|\).

			Dans ce cas, le flot maximum dans \(\mathcal{N}\) est de valeur \(k < |A|\) (par le point précédent).

			Alors, par le théorème \og{}min cut = max flot\fg{}, il existe une \((s,p)\)-coupe \((X, \ol X)\) de capacité \(k < |A|\).

			De plus, par le point~\ref{td3:ex4:1}, il existe une coupe minimale \((X, \ol X)\) avec aucune arête de \(X \cap A\) vers \(B \setminus X\). Il en suit 
			\begin{equation*}
				c(X, \ol X) = |A \setminus X| + |B \cap X| < |A| \implies |B \cap X| < |X \cap A|
			\end{equation*}
			Alors, en posant \(S = X \cap A\), on a bien \(|N(S)| \leq |B \cap X| < |X \cap A| = |S|\).
		\end{enumerate}
	\end{td-sol}
}{}


% ----- Consignes exo 5 ----- %
\begin{td-exo}[Convexité]\,\\ % 5 
	% fill
\end{td-exo}

% ----- Solutions exo 5 ----- %
\iftoggle{showsolutions}{
	\begin{td-sol}[]\,\\ %
		A remplir %TODO solve exercise 5
	\end{td-sol}
}{}


% ----- Consignes exo 6 ----- %
\begin{td-exo}[Convexité]\,\\ % 6 
	% fill
\end{td-exo}

% ----- Solutions exo 6 ----- %
\iftoggle{showsolutions}{
	\begin{td-sol}[]\,\\ %
		A remplir %TODO solve exercise 6
	\end{td-sol}
}{}


% ----- Consignes exo 7 ----- %
\begin{td-exo}[Convexité]\,\\ % 7 
	% fill
\end{td-exo}

% ----- Solutions exo 7 ----- %
\iftoggle{showsolutions}{
	\begin{td-sol}[]\,\\ %
		A remplir %TODO solve exercise 7
	\end{td-sol}
}{}